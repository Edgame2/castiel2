openapi: 3.0.0
info:
  title: Castiel Main API
  description: >-
    Enterprise B2B SaaS platform for multi-tenant data management with vector search, AI enrichment, and comprehensive
    compliance controls.
  version: 1.0.0
  contact:
    name: API Support
    email: support@castiel.api
  license:
    name: Proprietary
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained from Auth Broker
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error type
        message:
          type: string
          description: Error message
        statusCode:
          type: number
          description: HTTP status code
      required:
        - error
        - message
        - statusCode
    ShardType:
      type: object
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        structuredSchema:
          type: object
          description: JSON Schema for structured data
        vectorizationEnabled:
          type: boolean
        vectorizationConfig:
          type: object
          properties:
            model:
              type: string
            chunkingStrategy:
              type: string
            textSources:
              type: array
              items:
                type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - tenantId
        - name
    Shard:
      type: object
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: string
          format: uuid
        shardTypeId:
          type: string
          format: uuid
        structuredData:
          type: object
        unstructuredData:
          type: string
        vectors:
          type: array
          items:
            type: number
          description: Embedding vectors (1536 dimensions)
        acl:
          type: array
          items:
            type: object
            properties:
              userId:
                type: string
                format: uuid
              groupId:
                type: string
                format: uuid
              permissions:
                type: array
                items:
                  type: string
                  enum:
                    - read
                    - write
                    - delete
                    - share
        metadata:
          type: object
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        createdBy:
          type: string
          format: uuid
        lastModifiedBy:
          type: string
          format: uuid
      required:
        - id
        - tenantId
        - shardTypeId
    Revision:
      type: object
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: string
          format: uuid
        shardId:
          type: string
          format: uuid
        revisionNumber:
          type: number
        changeType:
          type: string
          enum:
            - CREATE
            - UPDATE
            - DELETE
        data:
          type: object
          description: Snapshot of shard data
        createdAt:
          type: string
          format: date-time
        createdBy:
          type: string
          format: uuid
      required:
        - id
        - tenantId
        - shardId
        - revisionNumber
        - changeType
    VectorSearchResult:
      type: object
      properties:
        shard:
          $ref: '#/components/schemas/Shard'
        score:
          type: number
          description: Similarity score (0-1)
      required:
        - shard
        - score
    VectorizationJob:
      type: object
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: string
          format: uuid
        shardId:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - PENDING
            - PROCESSING
            - COMPLETED
            - FAILED
        config:
          type: object
          properties:
            model:
              type: string
            chunkingStrategy:
              type: string
        error:
          type: string
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - tenantId
        - shardId
        - status
    CacheStats:
      type: object
      properties:
        hits:
          type: number
        misses:
          type: number
        hitRate:
          type: number
        sets:
          type: number
        deletes:
          type: number
paths: {}
servers:
  - url: http://0.0.0.0:3001
    description: Development server
  - url: https://api.castiel.com
    description: Production server
security:
  - bearerAuth: []
tags:
  - name: Health
    description: Health check endpoints
  - name: ShardTypes
    description: Shard type management
  - name: Shards
    description: Shard data operations
  - name: ACL
    description: Access control management
  - name: Revisions
    description: Revision history
  - name: Vector Search
    description: Vector similarity search
  - name: Vectorization
    description: Embedding generation jobs
  - name: Cache Admin
    description: Cache management (admin only)
  - name: Risk Analysis
    description: Risk analysis, evaluation, and revenue at risk calculations
