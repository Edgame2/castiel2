# =============================================================================
# Castiel API - Environment Variables
# =============================================================================
# Copy this file to .env and fill in the values for your environment.
# Never commit .env files to version control!
#
# For production deployments, use Azure Key Vault or similar secret management.
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
PORT=3001
HOST=0.0.0.0
NODE_ENV=development
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# API & Frontend URLs
# -----------------------------------------------------------------------------
# Public API base URL (used for OAuth callbacks, invitation links, etc.)
PUBLIC_API_BASE_URL=http://localhost:3001

# Frontend base URL (used for invitation links, email links, etc.)
# Falls back to PUBLIC_API_BASE_URL if not set
FRONTEND_URL=http://localhost:3000

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
# Option 1: Use REDIS_URL (recommended for Azure Redis Cache)
REDIS_URL=redis://localhost:6379/0
# Example for Azure Redis Cache with TLS:
# REDIS_URL=rediss://:password@your-redis.redis.cache.windows.net:6380/0

# Option 2: Use individual components (if REDIS_URL is not provided)
# REDIS_HOST=localhost
# REDIS_PORT=6379
# REDIS_USERNAME=
# REDIS_PASSWORD=
# REDIS_TLS=false
# REDIS_DB=0

# -----------------------------------------------------------------------------
# JWT Configuration
# -----------------------------------------------------------------------------
# Access token secret (minimum 32 characters recommended for production)
JWT_ACCESS_SECRET=your-access-token-secret-minimum-32-characters-long
JWT_ACCESS_TOKEN_EXPIRY=8h

# Refresh token secret (minimum 32 characters recommended for production)
JWT_REFRESH_SECRET=your-refresh-token-secret-minimum-32-characters-long
JWT_REFRESH_TOKEN_EXPIRY=7d

# JWT issuer and audience (optional)
JWT_ISSUER=castiel
# JWT_AUDIENCE=

# JWT validation caching (enabled by default)
JWT_VALIDATION_CACHE_ENABLED=true
JWT_VALIDATION_CACHE_TTL=300

# -----------------------------------------------------------------------------
# OAuth Providers
# -----------------------------------------------------------------------------
# Google OAuth
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=

# GitHub OAuth
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
GITHUB_REDIRECT_URI=

# Microsoft OAuth
MICROSOFT_CLIENT_ID=
MICROSOFT_CLIENT_SECRET=
MICROSOFT_REDIRECT_URI=

# -----------------------------------------------------------------------------
# Google Workspace Integration OAuth
# -----------------------------------------------------------------------------
# GOOGLE_WORKSPACE_CLIENT_ID=
# GOOGLE_WORKSPACE_CLIENT_SECRET=
# GOOGLE_WORKSPACE_REDIRECT_URI=

# -----------------------------------------------------------------------------
# Azure Cosmos DB Configuration
# -----------------------------------------------------------------------------
COSMOS_DB_ENDPOINT=https://your-cosmos-account.documents.azure.com:443/
COSMOS_DB_KEY=your-cosmos-db-primary-key
COSMOS_DB_DATABASE_ID=castiel

# -----------------------------------------------------------------------------
# Monitoring & Observability
# -----------------------------------------------------------------------------
MONITORING_ENABLED=true
MONITORING_PROVIDER=application-insights
# Application Insights connection string (preferred) or instrumentation key
APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=your-key;IngestionEndpoint=https://your-region.in.applicationinsights.azure.com/
# APPINSIGHTS_INSTRUMENTATION_KEY=your-instrumentation-key
MONITORING_SAMPLING_RATE=1.0

# -----------------------------------------------------------------------------
# CORS Configuration
# -----------------------------------------------------------------------------
# Comma-separated list of allowed origins, or 'true' to allow all (development only)
CORS_ORIGIN=http://localhost:3000,http://localhost:3001
CORS_CREDENTIALS=true

# -----------------------------------------------------------------------------
# Security Configuration
# -----------------------------------------------------------------------------
# Enable rate limiting for login attempts (enabled by default in production)
LOGIN_RATE_LIMIT_ENABLED=true

# -----------------------------------------------------------------------------
# GraphQL Configuration
# -----------------------------------------------------------------------------
GRAPHQL_ENABLED=true
GRAPHQL_PLAYGROUND=true
GRAPHQL_PATH=/graphql

# -----------------------------------------------------------------------------
# Azure Key Vault Configuration
# -----------------------------------------------------------------------------
# Key Vault URL (e.g., https://your-keyvault.vault.azure.net/)
AZURE_KEY_VAULT_URL=
# Enable Key Vault (enabled by default in production)
ENABLE_KEY_VAULT=false
# Use Managed Identity (recommended for production)
KEY_VAULT_USE_MANAGED_IDENTITY=false
# Service Principal credentials (only if not using Managed Identity)
# AZURE_TENANT_ID=
# AZURE_CLIENT_ID=
# AZURE_CLIENT_SECRET=
# Key Vault cache TTL (milliseconds)
KEY_VAULT_CACHE_TTL=300000

# -----------------------------------------------------------------------------
# Azure Blob Storage Configuration
# -----------------------------------------------------------------------------
# Azure Storage connection string for document management
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=your-storage-account;AccountKey=your-account-key;EndpointSuffix=core.windows.net
AZURE_STORAGE_DOCUMENTS_CONTAINER=documents
AZURE_STORAGE_QUARANTINE_CONTAINER=quarantine
# Enable virus verification for uploaded documents
DOCUMENT_VIRUS_VERIFICATION=false

# -----------------------------------------------------------------------------
# Email Configuration
# -----------------------------------------------------------------------------
# Email provider: 'console', 'resend', or 'azure-acs'
EMAIL_PROVIDER=console
EMAIL_FROM_ADDRESS=no-reply@castiel.local
EMAIL_FROM_NAME=Castiel

# Resend email provider (if EMAIL_PROVIDER=resend)
RESEND_API_KEY=

# Azure Communication Services (if EMAIL_PROVIDER=azure-acs)
AZURE_ACS_CONNECTION_STRING=

# -----------------------------------------------------------------------------
# Tenant Membership & Invitations
# -----------------------------------------------------------------------------
INVITE_DEFAULT_EXPIRY_DAYS=7
INVITE_MIN_EXPIRY_DAYS=1
INVITE_MAX_EXPIRY_DAYS=30
INVITE_REMINDER_LEAD_HOURS=48
INVITE_LIFECYCLE_INTERVAL_MS=900000
INVITE_PER_TENANT_DAILY_LIMIT=100
INVITE_PER_ADMIN_DAILY_LIMIT=20
INVITE_EXPIRING_SOON_HOURS=72

# -----------------------------------------------------------------------------
# Content Generation System
# -----------------------------------------------------------------------------
ENABLE_CONTENT_GENERATION=false

# -----------------------------------------------------------------------------
# Embedding Job Configuration
# -----------------------------------------------------------------------------
EMBEDDING_JOB_ENABLED=true
# Comma-separated list of shard types to ignore for embedding jobs
EMBEDDING_JOB_IGNORED_SHARD_TYPES=c_dashboardVersion,c_dashboard

# -----------------------------------------------------------------------------
# Azure OpenAI Configuration
# -----------------------------------------------------------------------------
# Azure OpenAI endpoint (e.g., https://your-resource.openai.azure.com/)
AZURE_OPENAI_ENDPOINT=
AZURE_OPENAI_API_KEY=
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4o
AZURE_OPENAI_API_VERSION=2024-02-15-preview

# Cosmos DB Query Performance Configuration
# Slow query threshold in milliseconds (default: 1000ms)
COSMOS_DB_SLOW_QUERY_THRESHOLD_MS=1000
# Expensive query threshold in Request Units (default: 10 RUs)
COSMOS_DB_EXPENSIVE_QUERY_THRESHOLD_RU=10
# Enable slow query logging (default: true)
COSMOS_DB_ENABLE_SLOW_QUERY_LOGGING=true
# Enable performance metrics tracking (default: true)
COSMOS_DB_ENABLE_PERFORMANCE_METRICS=true

# Feature Flags Emergency Toggle
# Set to 'true' to enable emergency toggle (kill switch) on startup
# This disables ALL feature flags instantly - use only in critical incidents
FEATURE_FLAGS_EMERGENCY_DISABLE=false
