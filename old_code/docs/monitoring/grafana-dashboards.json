{
  "dashboards": [
    {
      "title": "Castiel - API Performance",
      "description": "API response times, error rates, and throughput",
      "panels": [
        {
          "title": "API Response Time (p50, p95, p99)",
          "targets": [
            {
              "expr": "histogram_quantile(0.50, rate(api_response_time_bucket[5m]))",
              "legendFormat": "p50"
            },
            {
              "expr": "histogram_quantile(0.95, rate(api_response_time_bucket[5m]))",
              "legendFormat": "p95"
            },
            {
              "expr": "histogram_quantile(0.99, rate(api_response_time_bucket[5m]))",
              "legendFormat": "p99"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Response Time (ms)",
            "max": 2000
          }
        },
        {
          "title": "API Error Rate",
          "targets": [
            {
              "expr": "rate(api_requests_total{status=~\"5..\"}[5m]) / rate(api_requests_total[5m]) * 100",
              "legendFormat": "Error Rate (%)"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Error Rate (%)",
            "max": 10
          }
        },
        {
          "title": "API Requests per Second",
          "targets": [
            {
              "expr": "rate(api_requests_total[5m])",
              "legendFormat": "{{endpoint}}"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Requests/sec"
          }
        }
      ]
    },
    {
      "title": "Castiel - Database Performance",
      "description": "Cosmos DB query performance and RU consumption",
      "panels": [
        {
          "title": "Query Execution Time",
          "targets": [
            {
              "expr": "histogram_quantile(0.95, rate(cosmos_query_duration_seconds_bucket[5m]))",
              "legendFormat": "p95 Query Time"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Time (seconds)"
          }
        },
        {
          "title": "Request Units (RU) Consumption",
          "targets": [
            {
              "expr": "rate(cosmos_ru_consumed_total[5m])",
              "legendFormat": "{{container}}"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "RU/sec"
          }
        },
        {
          "title": "Slow Queries (>1000ms)",
          "targets": [
            {
              "expr": "count(cosmos_query_duration_seconds > 1)",
              "legendFormat": "Slow Queries"
            }
          ],
          "type": "stat",
          "thresholds": {
            "steps": [
              { "value": 0, "color": "green" },
              { "value": 10, "color": "yellow" },
              { "value": 50, "color": "red" }
            ]
          }
        }
      ]
    },
    {
      "title": "Castiel - Embedding Pipeline",
      "description": "Embedding generation performance and queue depth",
      "panels": [
        {
          "title": "Embedding Queue Depth",
          "targets": [
            {
              "expr": "service_bus_queue_depth{queue=\"embedding-jobs\"}",
              "legendFormat": "Queue Depth"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Messages"
          }
        },
        {
          "title": "Embedding Processing Rate",
          "targets": [
            {
              "expr": "rate(embedding_jobs_processed_total[5m])",
              "legendFormat": "Jobs/sec"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Jobs/sec"
          }
        },
        {
          "title": "Embedding Failure Rate",
          "targets": [
            {
              "expr": "rate(embedding_jobs_failed_total[5m]) / rate(embedding_jobs_total[5m]) * 100",
              "legendFormat": "Failure Rate (%)"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Failure Rate (%)",
            "max": 10
          }
        }
      ]
    },
    {
      "title": "Castiel - Vector Search",
      "description": "Vector search latency and cache performance",
      "panels": [
        {
          "title": "Vector Search Latency (p95)",
          "targets": [
            {
              "expr": "histogram_quantile(0.95, rate(vector_search_duration_seconds_bucket[5m]))",
              "legendFormat": "p95 Latency"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Time (seconds)",
            "max": 5
          }
        },
        {
          "title": "Cache Hit Rate",
          "targets": [
            {
              "expr": "rate(redis_cache_hits_total[5m]) / (rate(redis_cache_hits_total[5m]) + rate(redis_cache_misses_total[5m])) * 100",
              "legendFormat": "Hit Rate (%)"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Hit Rate (%)",
            "min": 0,
            "max": 100
          }
        }
      ]
    },
    {
      "title": "Castiel - Integration Monitoring",
      "description": "Integration sync status and error rates",
      "panels": [
        {
          "title": "Sync Jobs by Status",
          "targets": [
            {
              "expr": "sum by (status) (sync_jobs_total)",
              "legendFormat": "{{status}}"
            }
          ],
          "type": "piechart"
        },
        {
          "title": "Sync Error Rate",
          "targets": [
            {
              "expr": "rate(sync_jobs_failed_total[5m]) / rate(sync_jobs_total[5m]) * 100",
              "legendFormat": "{{integration}}"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Error Rate (%)"
          }
        },
        {
          "title": "Service Bus Queue Depth",
          "targets": [
            {
              "expr": "service_bus_queue_depth",
              "legendFormat": "{{queue}}"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Messages"
          }
        }
      ]
    },
    {
      "title": "Castiel - Content Generation",
      "description": "Content generation job status and performance",
      "panels": [
        {
          "title": "Generation Jobs by Status",
          "targets": [
            {
              "expr": "sum by (status) (content_generation_jobs_total)",
              "legendFormat": "{{status}}"
            }
          ],
          "type": "piechart"
        },
        {
          "title": "Generation Processing Time",
          "targets": [
            {
              "expr": "histogram_quantile(0.95, rate(content_generation_duration_seconds_bucket[5m]))",
              "legendFormat": "p95 Processing Time"
            }
          ],
          "type": "graph",
          "yAxis": {
            "label": "Time (seconds)"
          }
        }
      ]
    }
  ]
}







